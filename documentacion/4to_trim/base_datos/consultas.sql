-- -----------------------------------------------------
-- Crear tablas
-- -----------------------------------------------------




-- MySQL Script generated by MySQL Workbench
-- Tue Sep 27 21:32:09 2022
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema lock_inventory
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema lock_inventory
-- -----------------------------------------------------
CREATE SCHEMA lock_inventory DEFAULT CHARACTER SET utf8 ;
USE lock_inventory ;

-- -----------------------------------------------------
-- Table rol
-- -----------------------------------------------------
CREATE TABLE rol (
  idrol INT NOT NULL AUTO_INCREMENT,
  nombre VARCHAR(45) NOT NULL,
  PRIMARY KEY (idrol))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table usuario
-- -----------------------------------------------------
CREATE TABLE usuario (
  idusuario VARCHAR(45) NOT NULL,
  nombre VARCHAR(45) NOT NULL,
  correo VARCHAR(45) NOT NULL,
  celular VARCHAR(45) NOT NULL,
  direccion VARCHAR(45) NOT NULL,
  rol INT NOT NULL,
  contraseña VARCHAR(45) NOT NULL,
  INDEX idrol_rol (rol ASC),
  PRIMARY KEY (idusuario),
  CONSTRAINT rol_idrol
    FOREIGN KEY (rol)
    REFERENCES rol (idrol)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table categoria
-- -----------------------------------------------------
CREATE TABLE categoria (
  idcategoria INT NOT NULL AUTO_INCREMENT,
  nombre VARCHAR(45) NOT NULL,
  PRIMARY KEY (idcategoria))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table producto
-- -----------------------------------------------------
CREATE TABLE producto (
  idproducto VARCHAR(45) NOT NULL,
  nombre VARCHAR(45) NOT NULL,
  marca VARCHAR(45) NOT NULL,
  categoria INT NOT NULL,
  precio DECIMAL(20) NOT NULL,
  stock_producto INT NOT NULL,
  PRIMARY KEY (idproducto),
  INDEX ind_producto_categoria (categoria ASC),
  CONSTRAINT fk_producto_categoria
    FOREIGN KEY (categoria)
    REFERENCES categoria (idcategoria)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table cliente
-- -----------------------------------------------------
CREATE TABLE cliente (
  idcliente VARCHAR(45) NOT NULL,
  idusuario VARCHAR(45) NOT NULL,
  PRIMARY KEY (idcliente),
  INDEX ind_cliente_usuario (idusuario ASC),
  CONSTRAINT fk_cliente_usuario
    FOREIGN KEY (idusuario)
    REFERENCES usuario (idusuario)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table factura
-- -----------------------------------------------------
CREATE TABLE factura (
  idfactura INT NOT NULL,
  fecha DATE NOT NULL,
  cliente VARCHAR(45) NOT NULL,
  total DECIMAL(20) NOT NULL,
  PRIMARY KEY (idfactura),
  INDEX ind_factura_cliente (cliente ASC),
  CONSTRAINT fk_cliente_factura
    FOREIGN KEY (cliente)
    REFERENCES cliente (idcliente)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table factura_producto
-- -----------------------------------------------------
CREATE TABLE factura_producto (
  idfactura_producto INT NOT NULL,
  cantidad_producto INT NOT NULL,
  idproducto VARCHAR(45) NOT NULL,
  INDEX ind_facturaproducto_factura (idfactura_producto ASC),
  INDEX ind_facturaproducto_producto (idproducto ASC),
  CONSTRAINT fk_factura_facturaproducto
    FOREIGN KEY (idfactura_producto)
    REFERENCES factura (idfactura)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT fk_producto_facturaproducto
    FOREIGN KEY (idproducto)
    REFERENCES producto (idproducto)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table proveedor
-- -----------------------------------------------------
CREATE TABLE proveedor (
  idproveedor INT NOT NULL AUTO_INCREMENT,
  nombre VARCHAR(45) NOT NULL,
  PRIMARY KEY (idproveedor))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table adquisicion
-- -----------------------------------------------------
CREATE TABLE adquisicion (
  idadquisicion VARCHAR(45) NOT NULL,
  fecha_de_adqui DATE NOT NULL,
  total_precio_adqui DECIMAL(20) NOT NULL,
  id_proveedor INT NOT NULL,
  PRIMARY KEY (idadquisicion),
  INDEX ind_adquisicion_proveedor (id_proveedor ASC),
  CONSTRAINT fk_proveedoe_adquisicion
    FOREIGN KEY (id_proveedor)
    REFERENCES proveedor (idproveedor)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table adquisicion_producto
-- -----------------------------------------------------
CREATE TABLE adquisicion_producto (
  idadquisicion VARCHAR(45) NOT NULL,
  id_productos VARCHAR(45) NOT NULL,
  precio_producto_adqui DECIMAL(20) NOT NULL,
  cant_productos_adqui INT NOT NULL,
  INDEX ind_adquisicionproducto_producto (id_productos ASC),
  INDEX ind_adquisicionproducto_adquisicion (idadquisicion ASC),
  CONSTRAINT fk_adquisicionprod_producto
    FOREIGN KEY (id_productos)
    REFERENCES producto (idproducto)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT fk_adquisicionprod_adquisicion
    FOREIGN KEY (idadquisicion)
    REFERENCES adquisicion (idadquisicion)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- insertar datos de tabla rol
-- -----------------------------------------------------

INSERT INTO `rol` values ('','admin'), ('','cliente'),('','vendedor');

-- -----------------------------------------------------
-- insertar datos de tabla usuario
-- -----------------------------------------------------

INSERT INTO `usuario`(`idusuario`, `nombre`, `correo`, `celular`, `direccion`, `rol`, `contraseña`) VALUES ('clie-1','juan','juan@gmail.com','3219087181','cra10#8-16','2','');

INSERT INTO `usuario`(`idusuario`, `nombre`, `correo`, `celular`, `direccion`, `rol`, `contraseña`) VALUES ('clie-2','diego','diego@gmail.com','3113449496','calle12#7-18','2','');

INSERT INTO `usuario`(`idusuario`, `nombre`, `correo`, `celular`, `direccion`, `rol`, `contraseña`) VALUES ('clie-3','steven','steven@gmail.com','3218175432','cra 48 #7-98','2','');

INSERT INTO `usuario`(`idusuario`, `nombre`, `correo`, `celular`, `direccion`, `rol`, `contraseña`) VALUES ('clie-4','johan','johan@gmail.com','3229527425','calle 85 # 34 - 43','2','');

INSERT INTO `usuario`(`idusuario`, `nombre`, `correo`, `celular`, `direccion`, `rol`, `contraseña`) VALUES ('clie-5','julian','julian@gmail.com','3116548465','av 116 # 45 - 30','2','');

INSERT INTO `usuario`(`idusuario`, `nombre`, `correo`, `celular`, `direccion`, `rol`, `contraseña`) VALUES ('vend-1','julian herreño','julian12@hotmail.com','3185694125','cra 51b #43 - 21','3','123456789');

INSERT INTO `usuario`(`idusuario`, `nombre`, `correo`, `celular`, `direccion`, `rol`, `contraseña`) VALUES ('vend-2','camila avila','cami1523avila@hotmail.com','3192395485','calle 26 # 21- 12','3','avila48');

-- -----------------------------------------------------
-- insertar datos de tabla categorias
-- -----------------------------------------------------


INSERT INTO `categoria`(`idcategoria`, `nombre`) VALUES (1,'Celulares');
INSERT INTO `categoria`(`idcategoria`, `nombre`) VALUES (2,'Tablets');
INSERT INTO `categoria`(`idcategoria`, `nombre`) VALUES (3,'Accesorios celular');
INSERT INTO `categoria`(`idcategoria`, `nombre`) VALUES (4,'Accesorios computador');
INSERT INTO `categoria`(`idcategoria`, `nombre`) VALUES (5,'Audifonos');

-- -----------------------------------------------------
-- insertar datos de tabla clientes
-- -----------------------------------------------------

INSERT INTO `cliente`(`idcliente`, `idusuario`) VALUES ('1','clie-1'),('2','clie-2'),('3','clie-3'),('4','clie-4'),('5','clie-5');

-- -----------------------------------------------------
-- insertar datos de tabla producto
-- -----------------------------------------------------

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('1','Diadema game G900','asus',5,65000,5);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('2','Diadema game G790','asus',5,70000,15);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('3','Audifonos original',' Apple 3.5',5,60000,5);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('4','Cargador LNIO','Samsung',3,95000,3);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('5','Silicone Case Samsung Flip 4','Samsung',3,28000,6);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('6','Cable Type C','Sony',3,16000,9);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('7','cable type C silicone plane','Nillkin H+Pro',3,20000,14);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('8','glass turtle ','Iphone',3,13000,1);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('9','Mouse ergonomico','Dell',4,42000,6);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('10','Bateria Samsung J2 core','Samsung',3,27000,8);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('11','Tablet SAMSUNG 12.4 Pulgadas S7 Fe Wifi color Negro','Samsung',2,2600000,2);

INSERT INTO `producto`(`idproducto`, `nombre`, `marca`, `categoria`, `precio`, `stock_producto`) VALUES ('12','iphone 14 pro max Pulgadas S7 Fe Wifi color Negro','iPhone',3,5700000,8);

-- -----------------------------------------------------
-- insertar datos de tabla proveedor
-- -----------------------------------------------------
INSERT INTO `proveedor`(`idproveedor`, `nombre`) VALUES ('1','telefonos y accesorios S.A.S.');
INSERT INTO `proveedor`(`idproveedor`, `nombre`) VALUES ('2','CIT Electronics');
INSERT INTO `proveedor`(`idproveedor`, `nombre`) VALUES ('3','Celulares Importados S.A.S');

-- -----------------------------------------------------
-- insertar datos de tabla adquisicion
-- -----------------------------------------------------
INSERT INTO `adquisicion`(`idadquisicion`, `fecha_de_adqui`, `total_precio_adqui`, `id_proveedor`) VALUES ('com-1','03/08/2022',162700,2);

INSERT INTO `adquisicion`(`idadquisicion`, `fecha_de_adqui`, `total_precio_adqui`, `id_proveedor`) VALUES ('com-2','15/08/2022',516000,1);

INSERT INTO `adquisicion`(`idadquisicion`, `fecha_de_adqui`, `total_precio_adqui`, `id_proveedor`) VALUES ('com-3','26/9/2022',709000,3);

INSERT INTO `adquisicion`(`idadquisicion`, `fecha_de_adqui`, `total_precio_adqui`, `id_proveedor`) VALUES ('com-4','27/09/2022',168000,3);

INSERT INTO `adquisicion`(`idadquisicion`, `fecha_de_adqui`, `total_precio_adqui`, `id_proveedor`) VALUES ('com-5','01/10/2020',13000,'2');

INSERT INTO `adquisicion`(`idadquisicion`, `fecha_de_adqui`, `total_precio_adqui`, `id_proveedor`) VALUES ('com-6','02/10/2021',10900000,1);


-- -----------------------------------------------------
-- insertar datos de tabla adquisicion_producto
-- -----------------------------------------------------



INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-1','1',65000,5);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-1','2',70000,15);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-2','3',60000,5);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-3','4',95000,3);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-4','5',28000,6);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-3','6',16000,9);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-3','7',20000,14);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-5','8',13000,1);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-1','9',42000,6);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-2','10',27000,8);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-6','11',2600000,2);

INSERT INTO `adquisicion_producto`(`idadquisicion`, `id_productos`, `precio_producto_adqui`, `cant_productos_adqui`) VALUES ('com-6','12',5700000,1);


-- -----------------------------------------------------
-- insertar datos de tabla factura
-- -----------------------------------------------------

INSERT INTO `factura`(`idfactura`, `fecha`, `cliente`, `total`) VALUES (1,'2022/08/30','1',203000);
INSERT INTO `factura`(`idfactura`, `fecha`, `cliente`, `total`) VALUES (2,'2022/09/01','2',200000);
INSERT INTO `factura`(`idfactura`, `fecha`, `cliente`, `total`) VALUES (3,'2022/09/12','1',421000);
INSERT INTO `factura`(`idfactura`, `fecha`, `cliente`, `total`) VALUES (4,'2022/09/15','3',5700000);
INSERT INTO `factura`(`idfactura`, `fecha`, `cliente`, `total`) VALUES (5,'2022/09/15','4',2780000);
INSERT INTO `factura`(`idfactura`, `fecha`, `cliente`, `total`) VALUES (6,'2022/09/24','5',2760000);
INSERT INTO `factura`(`idfactura`, `fecha`, `cliente`, `total`) VALUES (7,'2022/09/30','3',130000);


-- -----------------------------------------------------
-- insertar datos de tabla factura_producto
-- -----------------------------------------------------

INSERT INTO `factura_producto`(`idfactura_producto`, `cantidad_producto`, `idproducto`) VALUES ('1',2,'1'), ('1',1,'5'), ('1',2,'6'), ('1',1,'8');
INSERT INTO `factura_producto`(`idfactura_producto`, `cantidad_producto`, `idproducto`) VALUES ('2',2,'2'), ('2',1,'3');
INSERT INTO `factura_producto`(`idfactura_producto`, `cantidad_producto`, `idproducto`) VALUES ('3',1,'1'), ('3',2,'4'), ('3',2,'7'), ('3',3,'9');
INSERT INTO `factura_producto`(`idfactura_producto`, `cantidad_producto`, `idproducto`) VALUES ('4',1,'12');
INSERT INTO `factura_producto`(`idfactura_producto`, `cantidad_producto`, `idproducto`) VALUES ('5',3,'9'), ('5',2,'10'), ('5',1,'11');
INSERT INTO `factura_producto`(`idfactura_producto`, `cantidad_producto`, `idproducto`) VALUES ('6',1,'3'), ('6',5,'7'), ('6',1,'11');

INSERT INTO `factura_producto`(`idfactura_producto`, `cantidad_producto`, `idproducto`) VALUES ('7',2,'1');


-- -----------------------------------------------------
-- consultas
-- -----------------------------------------------------

-- ------------------------------------------------------------------------------------- --
-- seleccionar datos de una tabla ------------------------------------------------------------------- --
--      SELECT __ , __ FROM __ : ------------------------------------------------------- --
-- ------------------------------------------------------------------------------------- --
SELECT nombre, correo, celular FROM USUARIO;
SELECT nombre FROM rol;
SELECT idproveedor, nombre FROM proveedor;
SELECT nombre, marca, precio, categoria FROM producto;
SELECT cliente, total FROM factura;

-- ------------------------------------------------------------------------------------- --
-- Con Criterios. ----------------------------------------------------------------- --
--      SELECT __ , __ FROM __ WHERE __ = __ : ----------------------------------------- --
-- ------------------------------------------------------------------------------------- --
SELECT nombre, correo, celular FROM USUARIO
WHERE rol = 3;
SELECT nombre, correo, celular FROM USUARIO
WHERE rol = 2;
SELECT nombre, correo, celular FROM USUARIO
WHERE rol = 1;

-- ------------------------------------------------------------------------------------- --
-- 1.3. INNER JOIN. -------------------------------------------------------------------- --
--      SELECT _ FROM _ INNER JOIN _ ON _._ = _._ : ------------------------------------ --
-- ------------------------------------------------------------------------------------- --

SELECT factura.idfactura, factura.fecha, factura.cliente, factura_producto.idproducto, producto.nombre, factura_producto.cantidad_producto, factura.total FROM ((factura_producto INNER JOIN factura ON factura.idfactura = factura_producto.idfactura_producto)INNER JOIN producto ON factura_producto.idproducto = producto.idproducto);

SELECT * FROM proveedor INNER JOIN adquisicion
ON (proveedor.idproveedor = adquisicion.id_proveedor);

SELECT adquisicion.idadquisicion, adquisicion.fecha_de_adqui, adquisicion.id_proveedor, adquisicion_producto.id_productos, adquisicion_producto.cant_productos_adqui, adquisicion_producto.precio_producto_adqui, adquisicion.total_precio_adqui FROM adquisicion INNER JOIN adquisicion_producto
ON (adquisicion.idadquisicion = adquisicion_producto.idadquisicion);

SELECT * FROM producto INNER JOIN adquisicion_producto
ON (producto.idproducto = adquisicion_producto.id_productos);
-- mirar en que factura se adquirio el producto
SELECT producto.idproducto, producto.nombre, producto.marca, producto.categoria, producto.stock_producto, producto.precio, factura_producto.idfactura_producto, factura_producto.cantidad_producto FROM producto INNER JOIN factura_producto
ON (producto.idproducto = factura_producto.idproducto);
-- mirar categoria de cada producto
SELECT producto.idproducto, producto.nombre, producto.marca, categoria.idcategoria, categoria.nombre, producto.stock_producto, producto.precio FROM producto INNER JOIN categoria
ON (producto.categoria = categoria.idcategoria); 
-- mirara contenido de cada factura
SELECT factura_producto.idfactura_producto, factura.fecha, factura.cliente, factura_producto.idproducto, producto.nombre, factura_producto.cantidad_producto, factura.total  FROM factura_producto INNER JOIN factura
INNER JOIN producto ON (factura_producto.idfactura_producto = factura.idfactura) WHERE factura_producto.idfactura_producto = 1;
-- mirar campos completa de adquisicion
SELECT adquisicion.idadquisicion, adquisicion.fecha_de_adqui, adquisicion.id_proveedor, adquisicion_producto.id_productos, producto.nombre, adquisicion_producto.cant_productos_adqui, adquisicion_producto.precio_producto_adqui, adquisicion.total_precio_adqui FROM ((adquisicion_producto INNER JOIN adquisicion ON adquisicion.idadquisicion = adquisicion_producto.idadquisicion)INNER JOIN producto ON adquisicion_producto.id_productos = producto.idproducto);
-- mirar las facturas de cada cliente
SELECT factura.idfactura, factura.fecha, factura.cliente, usuario.nombre, factura.total FROM ((cliente INNER JOIN factura ON factura.cliente = cliente.idcliente)INNER JOIN usuario ON usuario.idusuario = cliente.idusuario);
-- mirar rol del usuarios
SELECT * FROM usuario INNER JOIN rol
ON (rol.idrol = usuario.rol);
